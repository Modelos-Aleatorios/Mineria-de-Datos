---
title: "Informe"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(knitr)
```

## Limpieza de datos

Lo primero que hemos hecho es tomar los datos provisto en Excel y hemos convertido los datos a números y las variables como porcentajes también se han convertido a un número.

Las actividades realizadas paso a paso son las siguientes:

- `CTR`: Se dividió el número entre $100$ para convertirlo a un número.

- `Convrate`: Se división entre $10000$ para convertirla a número.

Después de realizar la conversión en Excel se cargaron los datos en **R** mediante el comando `read_delim`, donde especificamos el separador de los campos como ";" y el separador de miles "," y símbolo decimal ".".

A continuación podemos ver el comando ejecutado para importar los datos.
```{r, echo=TRUE}
data <- read_delim("../data/ROW.csv", 
    ";", escape_double = FALSE, locale = locale(decimal_mark = ",", 
    grouping_mark = "."), trim_ws = TRUE)

head(data, n=6)
```

Como se puede observar los datos se encuentran en un directorio `data`.

## Variables

| Nombre          | Descripción                                                                 |
|-----------------|-----------------------------------------------------------------------------|
| Adgroup         | Grupos de campañas publicitarias                                            |
| MaxCPC          | Lo que el dueño de la campaña está dispuesto a pagar por publicidad. (Bid)  |
| Clicks          | Número de veces que un usuario de internet hace click sobre la publicidad.  |
| Impressions     | Total de veces que la publicidad fué impresa en internet.  |
| CTR             | Cociente entre Clicks e Impressions   |
| AvgCPC          | Lo que termina pagando por la publicación de la publicidad.  |
| Costo           | Gasto de publicidad. |
| AvgPosition     | Posición promedio en la que sale el anuncio publicitario. |
| Qscore[^1]      | Puntaje de calidad de la publicidad.  |
| Ventas          | Total de ventas. |
| Costconv        | Cociente entre Costo y Ventas.  |
| Convrate        | Cociente entre Ventas y Clicks.  |
| Allconv         | Igual a las Ventas. |

A continuación podemos ver las variables y los tipos de cada una de las variables mediante el comando `str`.
```{r}
str(data)
```

Como la variable `Allconv` es redundante se eliminó.

```{r}
data<-data[,-13]
```

## Relación entre las variables

Hemos visto que varias de las variables son el resultado del cociente entre otras dos variables. En particular `CTR`, `AvgCPC`, `Convrate` y `Convcost`.

$$
\begin{array}{ll}
\vspace{3mm} CTR&=\displaystyle\frac{Click}{Impression}\\ 
\vspace{3mm} AvgCPC&=\displaystyle\frac{Costo}{Clicks}\\
\vspace{3mm} Convrate&=\displaystyle\frac{Ventas}{Clicks}\\
Convcost&=\displaystyle\frac{Costo}{Ventas}
\end{array}
$$


## Estadística descriptiva

Primero vamos a obtener la lista de las campañas que se han realizado.

Para ello creamos un vector con todas las campañas y eliminamos los elementos repetidos.
```{r}
varsv<-unique(as.vector(data$Adgroup))
```

Podemos ver que son `r length(varsv)` variables. Estas son: `r varsv`.

Ahora vamos a asignar un valor numérico a cada campaña y así sólo contar con variables numéricas.

```{r}
for(i in 1:(length(varsv))) {
  data$Adgroup[data$Adgroup==varsv[i]]<-i
}
data$Adgroup<-as.numeric(data$Adgroup)
```



```{r}

colnames(data)<-c("Adgroup","MaxCPC","Clicks","Impr",
                    "CTR","AvgCPC","Costo","AvgPos","Qscore",
                    "Ventas","Costc","Convr")

M<-as.matrix(data)

kable(round(cor(M),digits = 2))

plot(data)

plot(data$Costo[data$Ventas>0],data$Ventas[data$Ventas>0])

#c(data$Costo[data$Ventas>0],data$Ventas[data$Ventas>0])

#c(data$Costo,data$Ventas)

# Relación entre Costos y Ventas
# 
mcostventas<-as.data.frame(cbind(data$Costo, data$Ventas))

colnames(mcostventas)<-c("Costo", "Ventas")
#mcostventas

mcvordered<-mcostventas[order(mcostventas$Costo),]

plot(mcvordered, type="l")


# Relación entre Impresiones y Clicks

mic<-as.data.frame(cbind(data$Impr, data$Clicks))

colnames(mic)<-c("Impr", "Clicks")
#mic

micordered<-mic[order(mic$Impr),]

plot(micordered, type="l")


# Relación entre Qscore y Ventas

mqv<-as.data.frame(cbind(data$Qscore, data$Ventas))

colnames(mqv)<-c("Qscore", "Ventas")
#mqv

mqvordered<-mqv[order(mqv$Qscore),]

plot(mqvordered, type="l")


# Relación entre Qscore y AvgPosition

mqap<-as.data.frame(cbind(data$Qscore, data$AvgPos))

colnames(mqap)<-c("Qscore", "AvgPos")
#mqap

mqapordered<-mqap[order(mqap$Qscore),]

plot(mqapordered, type="l")


# Relación entre AvgPosition y Ventas

mapv<-as.data.frame(cbind(data$AvgPos, data$Ventas))

colnames(mapv)<-c("AvgPos", "Ventas")
#mapv

mapvordered<-mapv[order(mapv$AvgPos),]

plot(mapvordered, type="l")

# Relación entre Qscore y Impr

mqi<-as.data.frame(cbind(data$Qscore, data$Impr))

colnames(mqi)<-c("Qscore", "Impr")
#mqi

mqiordered<-mqi[order(mqi$Qscore),]

plot(mqiordered, type="l")

# Relación entre Click y Costo

mcc<-as.data.frame(cbind(data$Clicks, data$Costo))

colnames(mcc)<-c("Clicks", "Costo")
#mcc

mccordered<-mcc[order(mcc$Clicks),]

plot(mccordered, type="l")


# Relación entre AvgPos y Clicks

mapc<-as.data.frame(cbind(data$AvgPos, data$Clicks))

colnames(mapc)<-c("AvgPos", "Clicks")
#mapc

mapcordered<-mapc[order(mapc$AvgPos),]

plot(mapcordered, type="l")


# Relación entre MaxCPC y AvgPos

mmcap<-as.data.frame(cbind(data$MaxCPC, data$AvgPos))

colnames(mmcap)<-c("MaxCPC", "AvgPos")
#mmcap

mmcapordered<-mmcap[order(mmcap$MaxCPC),]

plot(mmcapordered, type="l")


par(mfrow=c(1,2))
plot(data$Costo[data$Costc>0],data$Costc[data$Costc>0])
plot(data$Ventas[data$Costc>0],data$Costc[data$Costc>0])
par(mfrow=c(1,1))

```

Estudiar la distribución de cada variable
```{r}
summary(data$MaxCPC)
hist(data$MaxCPC, breaks=100)

#sort(data$Clicks[data$Clicks>0])
summary(data$Clicks[data$Clicks>0])
hist(data$Clicks[data$Clicks>0], breaks = 100)

summary(data$Impr)
data$Impr[data$Impr>0]
hist(data$Impr[data$Impr>0],breaks = 100)

#data$CTR
summary(data$CTR[data$CTR>0])
hist(data$CTR[data$CTR>0],breaks = 100)

summary(data$AvgCPC[data$AvgCPC>0])
hist(data$AvgCPC[data$AvgCPC>0], breaks = 100)

summary(data$Costo[data$Costo>0])
hist(data$Costo[data$Costo>0], breaks = 100)


hist(data$AvgPos,breaks = 100)
hist(data$Qscore[data$Qscore>0], breaks = 100)

hist(data$Ventas, breaks = 100)

hist(data$Costc, breaks=100)

hist(data$Convr, breaks = 100)
```


[^1]: [Definición y uso de QScore](https://support.google.com/adwords/answer/7050591)

